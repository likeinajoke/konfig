## ВАРИАНТ 4  
## Учебный конфигурационный парсер (XML)

Инструмент командной строки для преобразования конфигурационных файлов,  
написанных на учебном языке, в **валидный XML** с поддержкой констант,  
выражений и вложенных структур.

Проект предназначен для учебных целей: демонстрации работы парсеров,  
грамматик и абстрактных синтаксических деревьев.

---

## Запуск

```bash
# Запуск с файлом конфигурации
python main.py config.txt
```

---

## Пример

### Входной файл (`config.txt`)

```text
--[[ Тестовый конфиг ]]

set speed = 0xA;
set time = 0x3;
set distance = (* speed time);

result: $[
  speed: speed,
  time: time,
  distance: distance
];
```
Также было реализовано три файла с примерами описания конфигураций из разных предметных областей: 
`math_config.txt`, `physics_config.txt`, `chemistry_config.txt`. Запуск производится также, как и в приведённом выше примере.

### Выход

```xml
<?xml version="1.0" ?>
<config>
  <entry name="result">
    <entry name="speed">10</entry>
    <entry name="time">3</entry>
    <entry name="distance">30</entry>
  </entry>
</config>
```

---

## Синтаксис языка

### 1. **Объявление констант**

```text
set имя = значение;
```

- Имя: `[_a-zA-Z][_a-zA-Z0-9]*`
- Значение вычисляется один раз
- Повторное объявление запрещено

Пример:

```text
set max_players = 0x10;
set timeout = 0x5;
```

---

### 2. **Использование констант**

```text
имя
```

Константа может использоваться в любом месте, где ожидается значение.

Пример:

```text
set a = 0x2;
set b = 0x3;
set c = (* a b);
```

---

### 3. **Числа**

Поддерживаются **только шестнадцатеричные числа**:

```text
0xA
0x1F
0X10
```

---

### 4. **Префиксные выражения**

```text
(оператор аргумент1 аргумент2 ...)
```

Поддерживаемые операторы:

| Оператор | Описание |
|---------|----------|
| `+`     | сложение |
| `-`     | вычитание / унарный минус |
| `*`     | умножение |
| `pow`   | возведение в степень |

Примеры:

```text
(+ 1 2 3)
(* speed time)
(pow 2 3)
(- 5)
```

---

### 5. **Массивы**

```text
{ значение, значение, ... }
```

Пример:

```text
set values = { 0x1, 0x2, 0x3 };
```

---

### 6. **Словари**

```text
$[
  ключ: значение,
  ключ: значение
]
```

- Ключи — идентификаторы
- Значения могут быть любыми допустимыми выражениями
- Дублирование ключей запрещено

Пример:

```text
settings: $[
  width: 0x80,
  height: 0x60
];
```

---

### 7. **Корневые элементы**

Только записи вида:

```text
ключ: значение;
```

попадают в итоговый XML.

Объявления `set` используются **только для вычислений** и в вывод не попадают.

---

### 8. **Комментарии**

Поддерживаются только многострочные комментарии:

```text
--[[
Комментарий
на несколько строк
]]
```

Комментарии полностью игнорируются парсером.

---

## XML-вывод

- Корневой элемент: `<config>`
- Каждая запись → `<entry name="...">`
- Вложенные словари и массивы рекурсивно сериализуются
- Вывод форматируется (pretty print)

Пример:

```xml
<entry name="data">
  <entry name="x">10</entry>
  <entry name="y">20</entry>
</entry>
```

---

## Обработка ошибок

Парсер выявляет и сообщает:

- Использование **необъявленных констант**
- Повторное объявление констант
- Дублирование ключей в словарях
- Ошибки синтаксиса (`;`, `:`, `{}`, `$[]`)
- Некорректные выражения
- Неверные операторы

Пример ошибки:

```text
Error: Undefined constant 'speed' at line 7
```

При наличии ошибок:
- XML **не выводится**

---
